@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Home Admin";
    Layout = "_LayoutAdmin";
}
    <!--  Header End -->
    <div class="container-fluid">
        <!--  Row 1 -->
        <div class="row">
            <div class="col-lg-8 d-flex align-items-strech">
                <div class="card w-100">
                    <div class="card-body" id="revenueTicketChart">
                        <div class="d-sm-flex d-block align-items-center justify-content-between mb-9">
                            <div class="mb-3 mb-sm-0">
                                <h5 class="card-title fw-semibold">Ticket Sales</h5>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked>
                                    <label class="form-check-label" for="flexSwitchCheckChecked">Month</label>
                                </div>
                            </div>
                            <div class="mb-3 mb-sm-0">
                                <div class="input-group">
                                    <input type="date" id="inputSearchDate" class="form-control" placeholder="dd-mm-yyyy" value="" min="2023-01-01" max="2023-12-31" name="search"><input name="__Invariant" type="hidden" value="search">
                                    <button type="submit" id="btnDate" class="btn btn-outline-primary">OK</button>
                                </div>
                            </div>
                        </div>
                       @* <div id="chart"></div>*@
                    </div>
                <nav aria-label="Page navigation example">
                    <ul class="pagination  justify-content-end" id="pagingTicket">
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                         <li class="page-item"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                    </ul>
                </nav>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-12">
                        <!-- Yearly Breakup -->
                        <div class="card overflow-hidden">
                            <div class="card-body p-4">
                                <h5 class="card-title mb-9 fw-semibold">Yearly Breakup</h5>
                                <div class="row align-items-center">
                                    <div class="col-8">
                                        <h4 class="fw-semibold mb-3" id="yearEarningValue">$36,358</h4>
                                        <div class="d-flex align-items-center mb-3">
                                            <span class="me-1 rounded-circle bg-light-danger round-20 d-flex align-items-center justify-content-center">
                                                <i class="ti ti-arrow-up-left text-success" id="iconYear"></i>
                                            </span>
                                            <p class="text-dark me-1 fs-3 mb-0" id="yearEarningPercent">+9%</p>
                                            <p class="fs-3 mb-0">last year</p>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <div class="me-4">
                                                <span class="round-8 bg-primary rounded-circle me-2 d-inline-block"></span>
                                                <span class="fs-2" id="yearCurrent">2023</span>
                                            </div>
                                            <div>
                                                <span class="round-8 bg-light-primary rounded-circle me-2 d-inline-block"></span>
                                                <span class="fs-2" id="yearLast">2023</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="d-flex justify-content-center">
                                        @*    <div id="breakup"></div>*@
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <!-- Monthly Earnings -->
                        <div class="card">
                            <div class="card-body">
                                <div class="row alig n-items-start">
                                    <div class="col-8">
                                        <h5 class="card-title mb-9 fw-semibold" id="monthCurrent"> Monthly Earnings </h5>
                                        <h4 class="fw-semibold mb-3" id="totalPayMonthCurrent">$6,820</h4>
                                        <div class="d-flex align-items-center pb-1">
                                            <span class="me-2 rounded-circle bg-light-danger round-20 d-flex align-items-center justify-content-center">
                                                <i class="ti ti-arrow-down-right text-danger" id="iconMonth"></i>
                                            </span>
                                            <p class="text-dark me-1 fs-3 mb-0" id="increaseMonth">+9%</p>
                                            <p class="fs-3 mb-0">last month</p>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="d-flex justify-content-end">
                                            <div class="text-white bg-success rounded-circle p-6 d-flex align-items-center justify-content-center">
                                                <i class="ti ti-currency-dollar fs-6"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*<div id="earning"></div>*@
                       
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4 d-flex align-items-stretch">
                <div class="card w-100">
                    <div class="card-body p-4">
                        <div class="mb-4">
                            <h5 class="card-title fw-semibold">Payment System Record</h5>
                        </div>
                        <ul class="timeline-widget mb-0 position-relative mb-n5" id="paymentRecord">   
                          
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 d-flex align-items-stretch">
                <div class="card w-100">
                    <div class="card-body p-4">
                    <h5 class="card-title fw-semibold mb-4">Summary Revenue Movie</h5>
                        <div class="table-responsive">
                            <table class="table text-nowrap mb-0 align-middle">
                                <thead class="text-dark fs-4">
                                    <tr>
                                        <th class="border-bottom-0">
                                            <h6 class="fw-semibold mb-0">Id</h6>
                                        </th>
                                        <th class="border-bottom-0">
                                            <h6 class="fw-semibold mb-0">Movie</h6>
                                        </th>
                                        <th class="border-bottom-0">
                                            <h6 class="fw-semibold mb-0">Viewer</h6>
                                        </th>
                                    <th class="border-bottom-0">
                                        <h6 class="fw-semibold mb-0">Rate</h6>
                                    </th>
                                        <th class="border-bottom-0">
                                            <h6 class="fw-semibold mb-0">Total</h6>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="totalRevenue">

                                </tbody>
                            </table>
                        <nav aria-label="Page navigation example">
                            <ul class="pagination  justify-content-end" id="pagingTotal">

                            </ul>
                        </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="top4Movie">
           @* <div class="col-sm-6 col-xl-3">
                <div class="card overflow-hidden rounded-2">
                    <div class="position-relative">
                    <a href="javascript:void(0)"><img src="/Uploads/avatar.jpg" style="height:90px;width:80px;" class="card-img-top rounded-0" alt="..."></a>
                    </div>
                    <div class="card-body pt-3 p-4">
                        <h6 class="fw-semibold fs-4">Boat Headphone</h6>
                        <div class="d-flex align-items-center justify-content-between">
                            <h6 class="fw-semibold fs-4 mb-0">$50 <span class="ms-2 fw-normal text-muted fs-3"><del>$65</del></span></h6>
                            <ul class="list-unstyled d-flex align-items-center mb-0">
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-sm-6 col-xl-3">
                <div class="card overflow-hidden rounded-2">
                    <div class="position-relative">
                        <a href="javascript:void(0)"><img src="../assets/images/products/s5.jpg" class="card-img-top rounded-0" alt="..."></a>
                        <a href="javascript:void(0)" class="bg-primary rounded-circle p-2 text-white d-inline-flex position-absolute bottom-0 end-0 mb-n3 me-3" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add To Cart"><i class="ti ti-basket fs-4"></i></a>
                    </div>
                    <div class="card-body pt-3 p-4">
                        <h6 class="fw-semibold fs-4">MacBook Air Pro</h6>
                        <div class="d-flex align-items-center justify-content-between">
                            <h6 class="fw-semibold fs-4 mb-0">$650 <span class="ms-2 fw-normal text-muted fs-3"><del>$900</del></span></h6>
                            <ul class="list-unstyled d-flex align-items-center mb-0">
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-xl-3">
                <div class="card overflow-hidden rounded-2">
                    <div class="position-relative">
                        <a href="javascript:void(0)"><img src="../assets/images/products/s7.jpg" class="card-img-top rounded-0" alt="..."></a>
                        <a href="javascript:void(0)" class="bg-primary rounded-circle p-2 text-white d-inline-flex position-absolute bottom-0 end-0 mb-n3 me-3" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add To Cart"><i class="ti ti-basket fs-4"></i></a>
                    </div>
                    <div class="card-body pt-3 p-4">
                        <h6 class="fw-semibold fs-4">Red Valvet Dress</h6>
                        <div class="d-flex align-items-center justify-content-between">
                            <h6 class="fw-semibold fs-4 mb-0">$150 <span class="ms-2 fw-normal text-muted fs-3"><del>$200</del></span></h6>
                            <ul class="list-unstyled d-flex align-items-center mb-0">
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-xl-3">
                <div class="card overflow-hidden rounded-2">
                    <div class="position-relative">
                        <a href="javascript:void(0)"><img src="../assets/images/products/s11.jpg" class="card-img-top rounded-0" alt="..."></a>
                        <a href="javascript:void(0)" class="bg-primary rounded-circle p-2 text-white d-inline-flex position-absolute bottom-0 end-0 mb-n3 me-3" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add To Cart"><i class="ti ti-basket fs-4"></i></a>
                    </div>
                    <div class="card-body pt-3 p-4">
                        <h6 class="fw-semibold fs-4">Cute Soft Teddybear</h6>
                        <div class="d-flex align-items-center justify-content-between">
                            <h6 class="fw-semibold fs-4 mb-0">$285 <span class="ms-2 fw-normal text-muted fs-3"><del>$345</del></span></h6>
                            <ul class="list-unstyled d-flex align-items-center mb-0">
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="me-1" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                                <li><a class="" href="javascript:void(0)"><i class="ti ti-star text-warning"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@
    </div>
@section Scripts{
    <script>
        var currentpage=1;
        var currentpage_ticket=1;
        var type = '';
        var date;
        var arrayBorder = ["primary", "danger", "success","warning","info"];
        $(document).ready(function () {
            LoadTotalRevenue(currentpage);
            LoadTicketRevenueChart(type, '', currentpage_ticket);
                var currentDate = new Date();
                var currentMonth = currentDate.getMonth() + 1;
                $('#monthCurrent').text('Monthly Earnings - ' + currentMonth);
                LoadMonthlyEarning();
                LoadYearlyEarning();
                var currentYear=currentDate.getFullYear();
                $('#yearCurrent').text(currentYear);
                $('#yearLast').text(currentYear-1);
                LoadSystemPayment();
        });
            function LoadYearlyEarning() {
                $.ajax({
                    url: '/Admin/GetYearlyEarning',
                    type: 'GET',
                    success: function (res) {
                        if (res.success) {
                            console.log(res.result);
                            var icon = document.getElementById('iconYear');
                            let money = parseInt(res.result.item1);
                            money = money.toLocaleString('en-US');
                            $('#yearEarningValue').text('$' + money);
                            let item2 = res.result.item2;
                            if (item2 >= 0) {
                                $('#yearEarningPercent').text('+' + item2 + '% ');
                                icon.className = 'ti ti-arrow-up-left text-success';
                            }
                            else {
                                $('#yearEarningPercent').text(item2 + '% ');
                                icon.className = 'ti ti-arrow-down-right text-danger';
                            }
                        }
                    }
                });
            }
        function LoadSystemPayment(){
                $.ajax({
                    url: '/Admin/GetSystemPayment',
                    type: 'GET',
                    success: function (res) {
                        if (res.success) {
                            $('#paymentRecord').empty();
                          console.log(res.result);
                          for(let i=0;i<4;i++){
                              var item=res.result[i];
                            let money = parseInt(item.total);
                            money = money.toLocaleString('en-US');
                            let border='<span class="timeline-badge border-2 border border-'+arrayBorder[i]+' flex-shrink-0 my-8"></span>';
                              let li=' <li class="timeline-item d-flex position-relative overflow-hidden"><div class="timeline-time text-dark flex-shrink-0 text-end">'+item.timePay+'</div>';
                              li+='<div class="timeline-badge-wrap d-flex flex-column align-items-center">';
                              li+=border;
                              li+='<span class="timeline-badge-border d-block flex-shrink-0"></span> </div>';
                              li+=' <div class="timeline-desc fs-3 text-dark mt-n1 fw-semibold">'+item.title+' payment of $'+money+' <a href="/ManageTicket/ViewBill?id='+item.id+ '" class="text-primary d-block fw-normal">#'+item.id+'</a></div> </li>';
                               $('#paymentRecord').append(li);
                          }
                        }
                    }
                });
        }
        function LoadMonthlyEarning(){
                $.ajax({
                    url: '/Admin/GetMonthlyEarning',
                    type: 'GET',
                    success: function (res) {
                        if (res.success) {
                            var icon = document.getElementById('iconMonth');
                            let money = parseInt(res.result.item1);
                            money = money.toLocaleString('en-US');
                            $('#totalPayMonthCurrent').text('$' + money);
                            let item2=res.result.item2;
                            if(item2>=0){
                                $('#increaseMonth').text('+'+item2 + '% ');
                                icon.className = 'ti ti-arrow-up-left text-success';
                            }
                            else{
                                $('#increaseMonth').text(item2 + '% ');
                                icon.className = 'ti ti-arrow-down-right text-danger';
                            }
                        }
                    }
                });
        }   
        function LoadTotalRevenue(currentPage) {
            $('#totalRevenue').empty();
            $.ajax({
                url: '/Admin/GetTotal',
                type: 'GET',
                data:{
                    currentPage: currentpage
                },
                success: function (res) {
                    if (res.success) {
                        for(let i=0;i<res.result.list.length;i++){
                            let index = i + 1;
                            let reviewer = parseInt(res.result.list[i].reviewer);
                            let rateNum = parseInt(res.result.list[i].rate);
                            let rate = (rateNum / reviewer).toFixed(1);
                            let money = parseInt(res.result.list[i].totalMoneyRevenue);
                            money = money.toLocaleString('en-US');
                            let li = '<tr>';
                            li += '<td class="border-bottom-0">';
                            li += '<h6 class="fw-semibold mb-0">' + index + '</h6>';
                            li += '</td>';
                            li += '<td class="border-bottom-0">';
                            li += '<h6 class="fw-semibold mb-1">' + res.result.list[i].title + '</h6>';
                            li += '</td>';
                            li += '<td class="border-bottom-0">';
                            li += '<span class="badge bg-primary rounded-3 fw-semibold">' + res.result.list[i].viewer + '</span>';
                            li += '</td>';
                            li += '<td class="border-bottom-0">';
                            li += '<p class="mb-0 fw-normal">' + rate + ' <i class="fa fa-star" style="font-size: 19px;color:#fac917;" aria-hidden="true"></i> </p>';
                            li += '</td>';
                            li += '<td class="border-bottom-0">';
                            li += '<h6 class="fw-semibold mb-0 fs-4">$ ' + money+ ' </h6>';
                            li += '</td>';
                            li += '</tr>';
                            // Thêm các mục vào bảng
                            $('#totalRevenue').append(li);
                        } /*top4Movie*/
                            //paging
                            $('#pagingTotal').empty();
                            if (res.result.totalPages > 1) {
                                let i = 0;
                                for (i = 1; i <= res.result.totalPages; i++) {
                                    let li = ' <li class="page-item" id="' + i + '">';
                                    li += '<a class="page-link" href="#">' + i + '</a></li>';
                                    $('#pagingTotal').append(li);
                                }
                                let li = $('#pagingTotal li#' + currentpage + '');
                                $(li).addClass('active');
                            }
                       //for(let i=0;i<4;i++){
                       //     let money = parseInt(res.result.list[i].totalMoneyRevenue);
                       //     money = money.toLocaleString('en-US');
                       //     let li = '<div class="col-sm-6 col-xl-3"><div class="card overflow-hidden rounded-2"> <div class="position-relative"><a href="javascript:void(0)"><img src="/Uploads/';
                       //     li += res.result.list[i].imagePosterMovie + '" style="height:90px;width:70px;" class="card-img-top rounded-0" alt="..."></a> </div>';
                       //     li += ' <div class="card-body pt-3 p-4"><h6 class="fw-semibold fs-4">' + res.result.list[i].title + '</h6>  <div class="d-flex align-items-center justify-content-between"> <h6 class="fw-semibold fs-4 mb-0">$' + money + '</h6>';
                       //     li += ' </div> </div> </div> </div>';
                       //     $('#top4Movie').append(li);
                       //}
                    }
                }
            });
        }
        var checkbox = document.getElementById("flexSwitchCheckChecked");
            checkbox.addEventListener("change", function () {
                if (this.checked) {
                    type='month';
                } else {
                   type='day';
                }
                LoadTicketRevenueChart(type,date,currentpage_ticket);
            });
        
        function LoadTicketRevenueChart(Type,term,currentPage){
                $.ajax({
                    url: '/Admin/GetTicketSales',
                    type: 'GET',
                    data: {
                        type: Type,
                        currentPage: currentPage,
                        date: term,
                    },
                    success: function (res) {
                        if (res.success) {
                            $('#revenueTicketChart .row').remove();
                            for(let i=0;i<res.result.list.length;i++){
                                var item = res.result.list[i];
                                var percent=0;
                                var valuePercent=0;
                                percent = Math.round(item.percent);
                                let li = ' <div class="row" style="margin-bottom:10px;"><h6 class="fw-semibold mb-1">' + item.title + '</h6> ';
                                li += '<div class="col-sm-12"><div class="progress"> <div class="progress-bar bg-info" role="progressbar" style="width: ' + percent + '%"aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">' + item.viewer + '</div>';
                                li += ' </div> </div> </div>';
                                $('#revenueTicketChart').append(li);
                            }
                            //paging
                            $('#pagingTicket').empty();
                            if (res.result.totalPages > 1) {
                                let i = 0;
                                for (i = 1; i <= res.result.totalPages; i++) {
                                    let li = ' <li class="page-item" id="' + i + '">';
                                    li += '<a class="page-link" href="#">' + i + '</a></li>';
                                    $('#pagingTicket').append(li);
                                }
                                let li = $('#pagingTicket li#' + currentpage_ticket + '');
                                $(li).addClass('active');
                            }

                            //
                        }
                    }
                });

        }
            $('#pagingTicket').on('click', 'li', function (e) {
                e.preventDefault();
                currentpage_ticket = $(this).text();
                LoadTicketRevenueChart(type, date, currentpage_ticket);
            });
            $("#btnDate").click(function (e) {
                e.preventDefault();
                date = $('#inputSearchDate').val();
                LoadTicketRevenueChart(type,date,currentpage_ticket);
            });
        $('#pagingTotal').on('click', 'li', function (e) {
            e.preventDefault();
            currentpage = $(this).text();
            LoadTotalRevenue(currentpage);
        });
    </script>
}